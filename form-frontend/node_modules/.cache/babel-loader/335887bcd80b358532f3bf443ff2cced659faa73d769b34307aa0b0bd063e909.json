{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{Link}from'react-router-dom';import'../styles/Home.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MyForms=()=>{const[forms,setForms]=useState([]);const[loading,setLoading]=useState(true);const user=JSON.parse(localStorage.getItem('user'));useEffect(()=>{fetchMyForms();},[]);const fetchMyForms=async()=>{try{const token=localStorage.getItem('token');if(!token){console.error('No token found');window.location.href='/login';return;}// ใช้ URL จาก environment variable และต่อด้วย /my-forms\nconst baseUrl=process.env.REACT_APP_API_URL||'http://192.168.17.15:5000';const response=await axios.get(`${baseUrl}/api/forms/my-forms`,{headers:{'Authorization':`Bearer ${token}`}});console.log('Raw API Response:',response.data);const formsData=Array.isArray(response.data)?response.data:[];console.log('Forms data after processing:',formsData);setForms(formsData);setLoading(false);}catch(error){var _error$response,_error$response2,_error$response3;console.error('Error fetching forms:',error);console.error('Error details:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);if(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status)===401||((_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status)===403){localStorage.removeItem('token');localStorage.removeItem('user');window.location.href='/login';}setLoading(false);}};const handleDelete=async id=>{try{const form=forms.find(f=>f.id===id);if(form.status!=='Draft'){alert('ไม่สามารถลบฟอร์มที่อยู่ในสถานะ Waiting For Approve หรือ Approved ได้');return;}if(!window.confirm('คุณแน่ใจหรือไม่ที่จะลบฟอร์มนี้?')){return;}const token=localStorage.getItem('token');await axios.delete(`${process.env.REACT_APP_API_URL}/api/forms/${id}`,{headers:{'Authorization':`Bearer ${token}`}});setForms(forms.filter(form=>form.id!==id));alert('ลบฟอร์มสำเร็จ');}catch(error){console.error('Error deleting form:',error);alert('เกิดข้อผิดพลาดในการลบฟอร์ม');}};const getStatusColor=status=>{switch(status){case'Draft':return'#FFA500';case'Waiting For Approve':return'#3498db';case'Approved':return'#2ecc71';default:return'#000000';}};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u0E01\\u0E33\\u0E25\\u0E31\\u0E07\\u0E42\\u0E2B\\u0E25\\u0E14...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-section\",children:/*#__PURE__*/_jsxs(\"h2\",{children:[\"My Forms - \",user===null||user===void 0?void 0:user.name]})}),/*#__PURE__*/_jsx(\"div\",{className:\"table-container\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"forms-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Form Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Department\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:forms.map(form=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:form.form_name}),/*#__PURE__*/_jsx(\"td\",{children:form.department}),/*#__PURE__*/_jsx(\"td\",{children:new Date(form.request_date).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge\",style:{backgroundColor:getStatusColor(form.status),color:'white',padding:'4px 8px',borderRadius:'4px',fontSize:'0.9em'},children:form.status})}),/*#__PURE__*/_jsxs(\"td\",{className:\"actions-cell\",children:[/*#__PURE__*/_jsx(\"a\",{href:`http://192.168.17.15:5000/view/${form.id}`,target:\"_blank\",rel:\"noopener noreferrer\",className:\"action-btn view-btn\",title:\"View Form\",children:\"\\uD83D\\uDC41 View\"}),form.status==='Draft'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{to:`/purchasepr?id=${form.id}`,state:{formData:form},className:\"action-btn edit-btn\",title:\"Edit Form\",children:\"\\u270F\\uFE0F Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(form.id),className:\"action-btn delete-btn\",title:\"Delete Form\",children:\"\\uD83D\\uDDD1\\uFE0F Delete\"})]})]})]},form.id))})]})})]});};export default MyForms;","map":{"version":3,"names":["React","useState","useEffect","axios","Link","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MyForms","forms","setForms","loading","setLoading","user","JSON","parse","localStorage","getItem","fetchMyForms","token","console","error","window","location","href","baseUrl","process","env","REACT_APP_API_URL","response","get","headers","log","data","formsData","Array","isArray","_error$response","_error$response2","_error$response3","status","removeItem","handleDelete","id","form","find","f","alert","confirm","delete","filter","getStatusColor","className","children","name","map","form_name","department","Date","request_date","toLocaleDateString","style","backgroundColor","color","padding","borderRadius","fontSize","target","rel","title","to","state","formData","onClick"],"sources":["C:/MyProjects/Orgforms/form-frontend/src/pages/MyForms.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { Link } from 'react-router-dom';\r\nimport '../styles/Home.css';\r\n\r\nconst MyForms = () => {\r\n  const [forms, setForms] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const user = JSON.parse(localStorage.getItem('user'));\r\n\r\n  useEffect(() => {\r\n    fetchMyForms();\r\n  }, []);\r\n\r\n  const fetchMyForms = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        console.error('No token found');\r\n        window.location.href = '/login';\r\n        return;\r\n      }\r\n\r\n      // ใช้ URL จาก environment variable และต่อด้วย /my-forms\r\n      const baseUrl = process.env.REACT_APP_API_URL || 'http://192.168.17.15:5000';\r\n      const response = await axios.get(`${baseUrl}/api/forms/my-forms`, {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`\r\n        }\r\n      });\r\n      \r\n      console.log('Raw API Response:', response.data);\r\n      \r\n      const formsData = Array.isArray(response.data) ? response.data : [];\r\n      console.log('Forms data after processing:', formsData);\r\n      \r\n      setForms(formsData);\r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error('Error fetching forms:', error);\r\n      console.error('Error details:', error.response?.data);\r\n      if (error.response?.status === 401 || error.response?.status === 403) {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('user');\r\n        window.location.href = '/login';\r\n      }\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id) => {\r\n    try {\r\n      const form = forms.find(f => f.id === id);\r\n      if (form.status !== 'Draft') {\r\n        alert('ไม่สามารถลบฟอร์มที่อยู่ในสถานะ Waiting For Approve หรือ Approved ได้');\r\n        return;\r\n      }\r\n\r\n      if (!window.confirm('คุณแน่ใจหรือไม่ที่จะลบฟอร์มนี้?')) {\r\n        return;\r\n      }\r\n\r\n      const token = localStorage.getItem('token');\r\n      await axios.delete(`${process.env.REACT_APP_API_URL}/api/forms/${id}`, {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`\r\n        }\r\n      });\r\n      \r\n      setForms(forms.filter(form => form.id !== id));\r\n      alert('ลบฟอร์มสำเร็จ');\r\n    } catch (error) {\r\n      console.error('Error deleting form:', error);\r\n      alert('เกิดข้อผิดพลาดในการลบฟอร์ม');\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case 'Draft':\r\n        return '#FFA500';\r\n      case 'Waiting For Approve':\r\n        return '#3498db';\r\n      case 'Approved':\r\n        return '#2ecc71';\r\n      default:\r\n        return '#000000';\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading-container\">\r\n        <div className=\"loading-spinner\"></div>\r\n        <p>กำลังโหลด...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"header-section\">\r\n        <h2>My Forms - {user?.name}</h2>\r\n      </div>\r\n      \r\n      <div className=\"table-container\">\r\n        <table className=\"forms-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Form Name</th>\r\n              <th>Department</th>\r\n              <th>Date</th>\r\n              <th>Status</th>\r\n              <th>Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {forms.map((form) => (\r\n              <tr key={form.id}>\r\n                <td>{form.form_name}</td>\r\n                <td>{form.department}</td>\r\n                <td>{new Date(form.request_date).toLocaleDateString()}</td>\r\n                <td>\r\n                  <span className=\"status-badge\" style={{ \r\n                    backgroundColor: getStatusColor(form.status),\r\n                    color: 'white',\r\n                    padding: '4px 8px',\r\n                    borderRadius: '4px',\r\n                    fontSize: '0.9em'\r\n                  }}>\r\n                    {form.status}\r\n                  </span>\r\n                </td>\r\n                <td className=\"actions-cell\">\r\n                  <a \r\n                    href={`http://192.168.17.15:5000/view/${form.id}`} \r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"action-btn view-btn\"\r\n                    title=\"View Form\"\r\n                  >\r\n                    👁 View\r\n                  </a>\r\n                  {form.status === 'Draft' && (\r\n                    <>\r\n                      <Link\r\n                        to={`/purchasepr?id=${form.id}`}\r\n                        state={{ formData: form }}\r\n                        className=\"action-btn edit-btn\"\r\n                        title=\"Edit Form\"\r\n                      >\r\n                        ✏️ Edit\r\n                      </Link>\r\n                      <button\r\n                        onClick={() => handleDelete(form.id)}\r\n                        className=\"action-btn delete-btn\"\r\n                        title=\"Delete Form\"\r\n                      >\r\n                        🗑️ Delete\r\n                      </button>\r\n                    </>\r\n                  )}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MyForms; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}