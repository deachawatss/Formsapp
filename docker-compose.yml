version: '3.8'

services:
  nwfth-forms:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: nwfth-forms-app
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - PORT=5000
      # Database configuration
      - DB_USER=dvl
      - DB_PASSWORD=Pr0gr@mm1ng
      - DB_SERVER=192.168.0.86
      - DB_NAME=TFCPILOT3
      - DB_PORT=49381
      # Email configuration
      - EMAIL_HOST=smtp.gmail.com
      - EMAIL_PORT=587
      - EMAIL_SECURE=false
      - EMAIL_USER=deachawat9937@gmail.com
      - EMAIL_PASS=yvpkb uzap qaee sqlg
      # JWT Secret
      - JWT_SECRET=1234567890111211311415
      # Active Directory configuration
      - AD_URL=ldap://192.168.0.1
      - AD_BASE_DN=DC=NWFTH,DC=com
      - AD_USERNAME=deachawat@newlywedsfoods.co.th
      - AD_PASSWORD=Wind@password1234
      # Frontend API URL configuration for server deployment
      - REACT_APP_API_URL=http://192.168.0.21:5000
      - FRONTEND_URL=http://192.168.0.21:5000
    networks:
      - app-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:5000/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) })"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  app-network:
    driver: bridge